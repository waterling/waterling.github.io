(this["webpackJsonpuks-test"]=this["webpackJsonpuks-test"]||[]).push([[0],{14:function(e,t,n){e.exports={menu:"LeftMenu_menu__3snqN",chosen:"LeftMenu_chosen__13_Nd",topPart:"LeftMenu_topPart__1wjTJ",logoContainer:"LeftMenu_logoContainer__CwqKo",userInfo:"LeftMenu_userInfo__6tKUH",name:"LeftMenu_name__3yaYJ",email:"LeftMenu_email__Yuxpe"}},17:function(e,t,n){e.exports={loginForm:"LoginForm_loginForm__20xLY",submitButton:"LoginForm_submitButton__QJo2z",row:"LoginForm_row__33q9m"}},20:function(e,t,n){e.exports={title:"StaticForm_title__2_HQ3",table:"StaticForm_table__2p_L-",grid:"StaticForm_grid__33g49",rows:"StaticForm_rows__Zzf7_"}},28:function(e,t,n){e.exports={container:"Form_container__3NLU8",title:"Form_title__2VTqt"}},29:function(e,t,n){e.exports={input:"Input_input__2A8Uu",label:"Input_label__2tSvc"}},32:function(e,t,n){e.exports={projects:"Profile_projects__3zpcA"}},33:function(e,t,n){e.exports={authPage:"AuthPages_authPage__1zYCf",content:"AuthPages_content__1bZ-O"}},47:function(e,t,n){e.exports={signInPage:"SignIn_signInPage__XmOQv"}},49:function(e,t,n){e.exports=n.p+"static/media/logo.69ac13d9.svg"},50:function(e,t,n){e.exports={navigation:"Navigation_navigation__1EgxP"}},51:function(e,t,n){e.exports=n(81)},80:function(e,t,n){},81:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"user",(function(){return j})),n.d(r,"auth",(function(){return O}));var a=n(0),s=n.n(a),o=n(21),c=n.n(o),i=n(6),u=n(16),l=n(3),f=n.n(l),m=n(8),h=n(12),p=n(9),d=n(45),b=new function e(t){var n=this;Object(p.a)(this,e),this.storage=void 0,this.save=function(e,t){n.storage.setItem(e,t)},this.get=function(e){return n.storage.getItem(e)},this.remove=function(e){n.storage.removeItem(e)},this.clear=function(){n.storage.clear()},this.storage=t}(localStorage),g=new(function(){function e(){var t=this;Object(p.a)(this,e),this.tokenKey="token",this.refreshTokenKey="rtk",this.set=function(e){b.save(t.tokenKey,e.accessToken),b.save(t.refreshTokenKey,e.refreshToken)},this.clear=function(){b.remove(t.tokenKey),b.remove(t.refreshTokenKey)}}return Object(d.a)(e,[{key:"accessToken",get:function(){return b.get(this.tokenKey)}},{key:"refreshToken",get:function(){return b.get(this.refreshTokenKey)}}]),e}()),v=n(46),_=n.n(v),E=new function e(t){var n=this;Object(p.a)(this,e),this.axios=void 0,this.refreshing=!1,this.failedRequests=[],this.setToken=function(e){var t=Object(h.a)({},e);return t.headers||(t.headers={}),t.headers.Authorization="Bearer ".concat(g.accessToken),t},this.checkAuthFailed=function(e){var t,r;return 401!==(null===(t=e.response)||void 0===t?void 0:t.status)||e.config.timeoutErrorMessage?(401===(null===(r=e.response)||void 0===r?void 0:r.status)&&e.config.timeoutErrorMessage&&(g.clear(),window.history.pushState({},"","/auth")),Promise.reject(e)):n.handleUnAuthorize(e)},this.handleUnAuthorize=function(){var e=Object(m.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.config,!n.refreshing){e.next=3;break}return e.abrupt("return",new Promise((function(e,t){n.failedRequests.push({resolve:e,reject:t})})).then((function(e){return r.headers.Authorization="Bearer "+e,n.axios(r)})).catch((function(e){return Promise.reject(e)})));case 3:return r.timeoutErrorMessage="true",n.refreshing=!0,e.abrupt("return",new Promise((function(e,t){n.axios.get("/auth/refresh",{params:{refresh:g.refreshToken}}).then((function(t){var a=t.data;g.set({refreshToken:a.refreshToken,accessToken:a.accessToken}),delete r.timeoutErrorMessage,n.processFailedRequests(null,g.accessToken),e(n.axios(r))})).catch((function(e){n.processFailedRequests(e,null),t(e)})).then((function(){return n.refreshing=!1}))})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.processFailedRequests=function(e,t){n.failedRequests.forEach((function(n){e?n.reject(e):t&&n.resolve(t)})),n.failedRequests=[]},this.axios=_.a.create({baseURL:t}),this.axios.interceptors.request.use(this.setToken),this.axios.interceptors.response.use((function(e){return e}),this.checkAuthFailed)}("http://dev-api.bimdata.ru/v1"),k=new function e(){Object(p.a)(this,e),this.fetchProfile=Object(m.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.axios.get("/users/me");case 2:return t=e.sent,e.abrupt("return",t.data.data);case 4:case"end":return e.stop()}}),e)})))},j=Object(u.createModel)({state:{profile:null},reducers:{setProfile:function(e,t){return Object(h.a)({},e,{profile:t})}},effects:function(e){return{fetchProfile:function(){return Object(m.a)(f.a.mark((function t(){var n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,k.fetchProfile();case 2:n=t.sent,e.user.setProfile(n);case 4:case"end":return t.stop()}}),t)})))()}}}}),N=new function e(){Object(p.a)(this,e),this.login=function(){var e=Object(m.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.axios.post("/auth/login",t);case 2:return n=e.sent,e.abrupt("return",n.data.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},O=Object(u.createModel)({state:{},reducers:{setToken:function(e,t){return g.set(t),Object(h.a)({},e,{token:t})}},effects:function(e){return{login:function(t){return Object(m.a)(f.a.mark((function n(){var r;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,N.login(t);case 2:r=n.sent,e.auth.setToken(r);case 4:case"end":return n.stop()}}),n)})))()}}}}),w=Object(u.init)({models:r}),x=n(11),P=n(13),y=n(34),T=n(23),F=n.n(T),M=n(24),L=n(28),I=n.n(L),C=function(e){var t=e.title,n=e.className,r=Object(M.a)(e,["title","className"]);return a.createElement("form",Object.assign({},r,{className:I.a.container}),a.createElement("h2",{className:I.a.title},t),a.createElement("div",{className:n},r.children))},S=n(29),q=n.n(S),A=function(e){e.children;var t=e.label,n=Object(M.a)(e,["children","label"]);return a.createElement("div",{className:q.a.input},a.createElement("span",{className:q.a.label},t),a.createElement("input",n))},K=function(e){return a.createElement("button",Object.assign({},e,{className:e.className}),e.children)},z=n(17),R=n.n(z),B=function(e){var t=e.onSubmit,n=Object(a.useState)(""),r=Object(y.a)(n,2),s=r[0],o=r[1],c=Object(a.useState)(""),i=Object(y.a)(c,2),u=i[0],l=i[1];return a.createElement(C,{onSubmit:function(e){e.preventDefault(),s&&u&&t({email:s,password:u})},title:"LoginForm",className:R.a.loginForm},a.createElement(A,{type:"text",label:"Email",value:s,className:R.a.row,onChange:Object(a.useMemo)((function(){return function(e){return o(e.target.value)}}),[])}),a.createElement(A,{type:"password",label:"Password",value:u,className:R.a.row,onChange:Object(a.useMemo)((function(){return function(e){return l(e.target.value)}}),[])}),a.createElement(K,{className:F()(R.a.row,R.a.submitButton)},"Login"))},U=n(47),J=n.n(U),Y=Object(i.b)(null,(function(e){return{login:e.auth.login}}))((function(e){var t=e.login,n=Object(a.useMemo)((function(){return function(e){t(e)}}),[t]);return a.createElement("div",{className:J.a.signInPage},a.createElement(B,{onSubmit:n}))})),Q=function(e){return g.accessToken?a.createElement(P.b,e,e.children):a.createElement(P.a,{to:"/auth"})},D=n(19),H=n(20),Z=n.n(H),V=function(e){var t,n="grid"===e.type,r="rows"===e.type;return a.createElement("div",{className:e.containerClassName},a.createElement("h2",{className:Z.a.title},e.title),a.createElement("div",{className:F()(Z.a.table,(t={},Object(D.a)(t,Z.a.grid,n),Object(D.a)(t,Z.a.rows,r),t))},e.data.map((function(e,t){return a.createElement(a.Fragment,{key:t},a.createElement("span",null,e.label),n&&a.createElement("span",null,e.value))}))))};V.defaultProps={data:[],title:"",type:"grid"};var X=V,G=n(32),W=n.n(G),$=[{label:"\u0418\u043c\u044f",field:"firstName"},{label:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f",field:"lastName"},{label:"\u042d\u043b. \u043f\u043e\u0447\u0442\u0430",field:"email"}],ee=[{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043f\u0440\u043e\u0435\u043a\u0442\u0430 1"},{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043f\u0440\u043e\u0435\u043a\u0442\u0430 2"},{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043f\u0440\u043e\u0435\u043a\u0442\u0430 3"}],te=Object(i.b)((function(e){return{profile:e.user.profile}}))((function(e){var t=Object(a.useMemo)((function(){return $.map((function(t){return Object(h.a)({},t,{value:e.profile[t.field]})}))}),[e.profile]);return a.createElement("div",{className:W.a.container},a.createElement(X,{title:"\u041e\u0441\u043d\u043e\u0432\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f",data:t}),a.createElement(X,{title:"\u041f\u0440\u043e\u0435\u043a\u0442\u044b",data:ee,type:"rows",containerClassName:W.a.projects}))})),ne=n(49),re=n.n(ne),ae=n(14),se=n.n(ae),oe=n(50),ce=n.n(oe),ie=function(e){return a.createElement("div",{className:ce.a.navigation},e.links.map((function(t){return a.createElement(x.c,{to:t.url,activeClassName:e.chosenClassName,key:t.url},a.createElement("span",null,t.label))})))};ie.defaultProps={links:[],chosenClassName:""};var ue=ie,le=[{url:"/profile",label:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"},{url:"/appeal",label:"\u041e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u044f"},{url:"/security",label:"\u0411\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u044c"}],fe=Object(i.b)((function(e){return{profile:e.user.profile}}))((function(e){var t=e.profile;return a.createElement("div",{className:se.a.menu},a.createElement("div",{className:se.a.topPart},a.createElement(x.b,{to:"/"},a.createElement("div",{className:se.a.logoContainer},a.createElement("img",{src:re.a,alt:"logo"}),a.createElement("span",null,"BIMDATA"))),a.createElement("div",{className:se.a.userInfo},a.createElement("span",{className:se.a.name},t.firstName," ",t.lastName),a.createElement("span",{className:se.a.email},t.email))),a.createElement(ue,{chosenClassName:se.a.chosen,links:le}))})),me=n(33),he=n.n(me),pe=Object(i.b)((function(e){return{profile:e.user.profile}}),(function(e){return{fetchProfile:e.user.fetchProfile}}))((function(e){return Object(a.useEffect)((function(){e.fetchProfile()}),[]),e.profile?a.createElement("div",{className:he.a.authPage},a.createElement(fe,null),a.createElement("div",{className:he.a.content},a.createElement(P.d,null,a.createElement(P.b,{path:"/profile"},a.createElement(te,null)),a.createElement(P.a,{exact:!0,to:"/profile",from:"/"}),a.createElement(P.b,{path:"*"},"Not Found")))):a.createElement("div",null,"Loading...")})),de=function(e){return g.accessToken?a.createElement(P.a,{to:"/"}):a.createElement(P.b,e,e.children)},be=Object(i.b)((function(e){return{token:e.auth.token}}))((function(){return a.createElement(x.a,null,a.createElement(P.d,null,a.createElement(de,{path:"/auth"},a.createElement(Y,null)),a.createElement(Q,{path:"/"},a.createElement(pe,null))))}));n(80);c.a.render(s.a.createElement(i.a,{store:w},s.a.createElement(be,null)),document.getElementById("root"))}},[[51,1,2]]]);
//# sourceMappingURL=main.8773437a.chunk.js.map